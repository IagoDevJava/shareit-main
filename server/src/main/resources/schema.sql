CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME  VARCHAR(256) NOT NULL UNIQUE,
    EMAIL VARCHAR(256) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID           BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRIPTION  VARCHAR(1024) UNIQUE,
    REQUESTER_ID BIGINT REFERENCES USERS (ID),
    CREATED      timestamp
);

CREATE TABLE IF NOT EXISTS ITEMS
(
    ID           BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME         VARCHAR(256)  NOT NULL,
    DESCRIPTION  VARCHAR(1024) NOT NULL,
    IS_AVAILABLE BOOLEAN       NOT NULL,
    OWNER_ID     BIGINT REFERENCES USERS (ID),
    REQUEST_ID   BIGINT REFERENCES REQUESTS (ID)
);

CREATE TABLE IF NOT EXISTS COMMENTS
(
    ID        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TEXT      VARCHAR(2048) UNIQUE NOT NULL,
    ITEM_ID   BIGINT REFERENCES ITEMS (ID),
    AUTHOR_ID BIGINT REFERENCES USERS (ID),
    CREATED   timestamp
);

CREATE TABLE IF NOT EXISTS BOOKINGS
(
    ID         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    START_DATE timestamp,
    END_DATE   timestamp,
    ITEM_ID    BIGINT REFERENCES ITEMS (ID),
    BOOKER_ID  BIGINT REFERENCES USERS (ID),
    STATUS     VARCHAR
);

UPDATE pg_database
SET datcollate='en_US.UTF-8',
    datctype='en_US.UTF-8'
WHERE datname = 'shareit';